<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>S√©ismes r√©cents et plaques tectoniques ‚Äì Moustapha Farah</title>

  <style>
    body {
      margin: 0;
      overflow: hidden;
      font-family: Arial, sans-serif;
      background: #000;
    }

    #globeViz {
      width: 100vw;
      height: 100vh;
    }

    /* Titre */
    .title {
      position: absolute;
      top: 15px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.65);
      padding: 8px 16px;
      border-radius: 10px;
      color: #ffffff;
      font-size: 18px;
      font-weight: bold;
      z-index: 10;
      pointer-events: none;
      text-align: center;
      white-space: nowrap;
    }

    /* Cr√©dit */
    .credit {
      position: absolute;
      bottom: 10px;
      right: 15px;
      color: #ffffff;
      font-size: 13px;
      opacity: 0.75;
      z-index: 10;
      pointer-events: none;
    }

    /* Panneau de contr√¥le */
    .controls {
      position: absolute;
      top: 65px;
      left: 15px;
      background: rgba(0, 0, 0, 0.6);
      padding: 10px 12px;
      border-radius: 8px;
      color: #fff;
      font-size: 14px;
      z-index: 10;
    }

    .controls label {
      display: block;
      cursor: pointer;
      margin-bottom: 6px;
    }

    .controls input {
      margin-right: 6px;
      cursor: pointer;
    }

    /* L√©gende */
    .legend {
      position: absolute;
      bottom: 50px;
      left: 15px;
      background: rgba(0, 0, 0, 0.6);
      padding: 10px 12px;
      border-radius: 8px;
      color: #fff;
      font-size: 13px;
      z-index: 10;
    }

    .legend h4 {
      margin: 0 0 6px 0;
      font-size: 14px;
      font-weight: bold;
    }

    .legend-item {
      display: flex;
      align-items: center;
      margin-bottom: 4px;
    }

    .legend-color {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      margin-right: 8px;
      flex-shrink: 0;
    }

    .c6 { background: rgba(255,80,80,0.85); }
    .c5 { background: rgba(255,160,80,0.8); }
    .c4 { background: rgba(255,220,120,0.75); }
    .c3 { background: rgba(120,200,255,0.65); }
  </style>

  <script src="//cdn.jsdelivr.net/npm/globe.gl"></script>
</head>

<body>
  <div id="globeViz"></div>

  <!-- TITRE -->
  <div class="title">
    S√©ismes r√©cents et plaques tectoniques (30 derniers jours)
  </div>

  <!-- Boutons ON / OFF -->
  <div class="controls">
    <label>
      <input type="checkbox" id="togglePlates" checked>
      Plaques tectoniques
    </label>
    <label>
      <input type="checkbox" id="toggleQuakes" checked>
      S√©ismes r√©cents
    </label>
  </div>

  <!-- L√©gende dynamique -->
  <div class="legend" id="legend">
    <h4>Magnitude des s√©ismes</h4>
    <div class="legend-item">
      <span class="legend-color c6"></span> ‚â• 6.0 (fort)
    </div>
    <div class="legend-item">
      <span class="legend-color c5"></span> 5.0 ‚Äì 5.9
    </div>
    <div class="legend-item">
      <span class="legend-color c4"></span> 4.0 ‚Äì 4.9
    </div>
    <div class="legend-item">
      <span class="legend-color c3"></span> &lt; 4.0
    </div>
  </div>

  <div class="credit">¬© Moustapha Farah</div>

  <script>
    const globe = new Globe(document.getElementById('globeViz'))
      .globeImageUrl('//cdn.jsdelivr.net/npm/three-globe/example/img/earth-dark.jpg')
      .bumpImageUrl('//cdn.jsdelivr.net/npm/three-globe/example/img/earth-topology.png')
      .backgroundImageUrl('//cdn.jsdelivr.net/npm/three-globe/example/img/night-sky.png')
      .atmosphereColor('#3a228a')
      .atmosphereAltitude(0.2);

    let tectonicPaths = [];
    let earthquakes = [];

    /* Plaques tectoniques */
    fetch('https://raw.githubusercontent.com/fraxen/tectonicplates/master/GeoJSON/PB2002_boundaries.json')
      .then(r => r.json())
      .then(data => {
        data.features.forEach(({ geometry, properties }) => {
          if (geometry.type === 'LineString') {
            tectonicPaths.push({ coords: geometry.coordinates, properties });
          } else if (geometry.type === 'MultiLineString') {
            geometry.coordinates.forEach(coords => {
              tectonicPaths.push({ coords, properties });
            });
          }
        });

        globe
          .pathsData(tectonicPaths)
          .pathPoints('coords')
          .pathPointLat(p => p[1])
          .pathPointLng(p => p[0])
          .pathColor(() => '#ff4500')
          .pathDashLength(0.05)
          .pathDashGap(0.01)
          .pathDashAnimateTime(7000)
          .pathResolution(3);
      });

    /* S√©ismes r√©cents */
    fetch('https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/all_month.geojson')
      .then(r => r.json())
      .then(eqData => {
        earthquakes = eqData.features
          .filter(d => d.properties.mag !== null)
          .map(d => ({
            lat: d.geometry.coordinates[1],
            lng: d.geometry.coordinates[0],
            mag: d.properties.mag,
            place: d.properties.place,
            time: new Date(d.properties.time).toLocaleString()
          }));

        globe
          .pointsData(earthquakes)
          .pointLat(d => d.lat)
          .pointLng(d => d.lng)
          .pointAltitude(d => Math.min(d.mag / 80, 0.03))
          .pointRadius(d => Math.min(Math.sqrt(d.mag) * 0.35, 1.4))
          .pointColor(d =>
            d.mag >= 6 ? 'rgba(255,80,80,0.85)' :
            d.mag >= 5 ? 'rgba(255,160,80,0.8)' :
            d.mag >= 4 ? 'rgba(255,220,120,0.75)' :
                         'rgba(120,200,255,0.65)'
          )
          .pointLabel(d => `
            <b>S√©isme</b><br/>
            üìç ${d.place}<br/>
            Magnitude : ${d.mag}<br/>
            Date : ${d.time}
          `);
      });

    /* ON / OFF + l√©gende */
    const legend = document.getElementById('legend');

    document.getElementById('togglePlates')
      .addEventListener('change', e => {
        globe.pathsData(e.target.checked ? tectonicPaths : []);
      });

    document.getElementById('toggleQuakes')
      .addEventListener('change', e => {
        globe.pointsData(e.target.checked ? earthquakes : []);
        legend.style.display = e.target.checked ? 'block' : 'none';
      });
  </script>
</body>
</html>
