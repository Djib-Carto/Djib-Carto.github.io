<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>Trafic Maritime Mondial – Moustapha Farah</title>

  <style>
    body {
      margin: 0;
      overflow: hidden;
      font-family: Arial, sans-serif;
      background: #000;
    }

    #globeViz { width: 100vw; height: 100vh; }

    /* Titre */
    .title {
      position: absolute;
      top: 15px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.7);
      padding: 10px 20px;
      border-radius: 12px;
      color: #00f2ff;
      font-size: 20px;
      font-weight: bold;
      z-index: 10;
      pointer-events: none;
      text-align: center;
      box-shadow: 0 0 10px rgba(0, 242, 255, 0.5);
    }

    /* Crédit */
    .credit {
      position: absolute;
      bottom: 15px;
      right: 15px;
      background: rgba(0,0,0,0.6);
      padding: 5px 10px;
      border-radius: 8px;
      color: #00f2ff;
      font-size: 12px;
      opacity: 0.9;
      z-index: 10;
      pointer-events: none;
    }

    /* Légende fixe */
    .legend {
      position: absolute;
      bottom: 50px;
      left: 15px;
      background: rgba(0,0,0,0.6);
      padding: 8px 12px;
      border-radius: 8px;
      color: #fff;
      font-size: 12px;
      z-index: 10;
      max-width: 200px;
    }

    .legend h4 { margin:0 0 6px 0; font-size:13px; font-weight:bold; }
    .legend-item { display:flex; align-items:center; margin-bottom:4px; }
    .legend-color { width:12px; height:12px; border-radius:50%; margin-right:8px; flex-shrink:0; }

    .major { background: #ff4500; }
    .middle { background: #ffdd00; }
    .minor { background: #88ccee; }
    .source { font-size: 10px; opacity: 0.7; margin-top: 6px; }
  </style>

  <script src="//cdn.jsdelivr.net/npm/globe.gl"></script>
</head>

<body>

<div id="globeViz"></div>

<div class="title">Trafic Maritime Mondial</div>

<!-- Légende -->
<div class="legend">
  <h4>Type de route</h4>
  <div class="legend-item"><span class="legend-color major"></span> Principale</div>
  <div class="legend-item"><span class="legend-color middle"></span> Moyenne</div>
  <div class="legend-item"><span class="legend-color minor"></span> Mineure</div>
  <div class="source">Source : Routes maritimes – Shipping Lanes (GitHub)</div>
</div>

<div class="credit">© Moustapha Farah</div>

<script>
  const globe = new Globe(document.getElementById('globeViz'))
    .globeImageUrl('//cdn.jsdelivr.net/npm/three-globe/example/img/earth-dark.jpg')
    .bumpImageUrl('//cdn.jsdelivr.net/npm/three-globe/example/img/earth-topology.png')
    .backgroundImageUrl('//cdn.jsdelivr.net/npm/three-globe/example/img/night-sky.png')
    .atmosphereColor('#1a4fff')
    .atmosphereAltitude(0.2)
    .enablePointerInteraction(true);

  let shippingRoutes = [];

  // Routes maritimes
  fetch('https://raw.githubusercontent.com/newzealandpaul/Shipping-Lanes/main/data/Shipping_Lanes_v1.geojson')
    .then(r => r.json())
    .then(data => {
      data.features.forEach(({ geometry, properties }) => {
        if (!geometry) return;
        if (geometry.type === 'LineString') shippingRoutes.push({ coords: geometry.coordinates, properties });
        else if (geometry.type === 'MultiLineString') geometry.coordinates.forEach(c => shippingRoutes.push({ coords: c, properties }));
      });

      // Créer le flux dans les deux sens
      const allRoutes = [
        ...shippingRoutes,
        ...shippingRoutes.map(r => ({ coords: [...r.coords].reverse(), properties: r.properties }))
      ];

      globe
        .pathsData(allRoutes)
        .pathPoints('coords')
        .pathPointLat(p => p[1])
        .pathPointLng(p => p[0])
        .pathColor(d => d.properties.Type==='Major'? '#ff4500': d.properties.Type==='Middle'? '#ffdd00':'#88ccee')
        .pathDashLength(0.08)
        .pathDashGap(0.02)
        .pathDashAnimateTime(8000)
        .pathResolution(4)
        .pathLabel(d => `<b>${d.properties.Type==='Major'?'Principale':d.properties.Type==='Middle'?'Moyenne':'Mineure'}</b>`);
    });

  // Ergonomie
  const controls = globe.controls();
  controls.autoRotate = true;
  controls.autoRotateSpeed = 0.3;
  controls.enableZoom = true;
  controls.zoomSpeed = 0.5;
  controls.enableRotate = true;
  controls.rotateSpeed = 0.4;
</script>

</body>
</html>
